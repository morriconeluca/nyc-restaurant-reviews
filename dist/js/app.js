"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(m,E,y){if(!m.fetch)throw new ClientError(400,"Fetch API Not Supported");E.gEBI=E.getElementById,E.cE=E.createElement,m.IntersectionObserver&&m.IntersectionObserverEntry&&"intersectionRatio"in m.IntersectionObserverEntry.prototype?"isIntersecting"in m.IntersectionObserverEntry.prototype||Object.defineProperty(m.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}}):i("js/intersection-observer.js");var ClientError=function ClientError(e,t){_classCallCheck(this,ClientError),this.code=e,this.message=t},t="http://localhost:1337/restaurants",n="http://localhost:1337/reviews",b=n+"/?restaurant_id=",u=void 0,l=void 0,s=void 0,d=void 0;function f(t){"loading"!==E.readyState?t():E.addEventListener("DOMContentLoaded",function e(){t(),E.removeEventListener("DOMContentLoaded",e)})}function w(a,c,s){if(m.indexedDB){var e=m.indexedDB.open("nyc_rr_data",1);return e.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore("restaurants",{keyPath:"id"}),t.createObjectStore("reviews",{keyPath:"id"}).createIndex("restaurant_id","restaurant_id",{unique:!1})},new Promise(function(n){e.onsuccess=function(e){var i=e.target.result,t=i.transaction([a],"readonly").objectStore(a),o="reviews"===a?t.index("restaurant_id"):t;n(new Promise(function(n){var r=[],e=s?IDBKeyRange.only(s):null;o.openCursor(e).onsuccess=function(e){var t=e.target.result;t||r.length?t?(r.push(t.value),y.onLine&&t.value.offline_request&&function(e,t){if(!y.serviceWorker||!m.SyncManager)return;"restaurants"===e?y.serviceWorker.controller.postMessage({action:"favorite-sync-"+t}):"reviews"===e&&y.serviceWorker.controller.postMessage({action:"review-sync-"+t})}(a,t.value.id),t.continue()):n(r):n(fetch(c).then(function(e){if(!e.ok)throw Error("Request failed. Returned status of "+e.statusText);return e.json()}).then(function(e){var t=i.transaction([a],"readwrite").objectStore(a);return e.forEach(function(e){t.put(e)}),e}).catch(function(e){console.log(e)}))},o.openCursor(e).onerror=function(e){console.log(e.target.error),n(p(a,c))}}))},e.onerror=function(e){console.log(e.target.error),n(p(a,c))}})}return p(a,c)}function p(e,t){return fetch(t).then(function(e){if(!e.ok)throw Error("Request failed. Returned status of "+e.statusText);return e.json()}).then(function(e){return e}).catch(function(e){console.log(e)})}function L(t){if(!y.onLine&&y.serviceWorker&&m.SyncManager&&m.indexedDB)return e(t,!0),void y.serviceWorker.ready.then(function(e){return e.sync.register("favorite-sync-"+t.id)}).catch(function(e){console.log(e),r(t)});m.indexedDB&&e(t),r(t)}function r(e){fetch(t+"/"+e.id+"/?is_favorite="+e.is_favorite,{method:"PUT"}).catch(function(e){console.log(e)})}function e(r,i){var e=m.indexedDB.open("nyc_rr_data",1);e.onsuccess=function(e){var n=e.target.result.transaction(["restaurants"],"readwrite").objectStore("restaurants"),t=n.get(r.id);t.onsuccess=function(e){var t=e.target.result;t.is_favorite=r.is_favorite,i&&(t.offline_request=!0),n.put(t).onerror=function(e){console.log(e.target.error)}},t.onerror=function(e){console.log(e.target.error)}},e.onerror=function(e){console.log(e.target.error)}}function k(i,o){return new Promise(function(r){var e=m.indexedDB.open("nyc_rr_data",1);e.onsuccess=function(e){var t=e.target.result.transaction(["reviews"],"readwrite").objectStore("reviews");o&&(i.offline_request=!0),i.id=i.id||"_"+Math.random().toString(36).substr(2,9);var n=t.put(i);n.onsuccess=function(){r(i.id)},n.onerror=function(e){console.log(e.target.error)}},e.onerror=function(e){console.log(e.target.error)}})}function I(e){fetch(n,{method:"POST",body:JSON.stringify(e),headers:new Headers({"Content-Type":"application/json"})}).then(function(){m.indexedDB&&fetch(""+b+e.restaurant_id).then(function(e){if(!e.ok)throw Error("Request failed. Returned status of "+e.statusText);return e.json()}).then(function(e){e.forEach(function(e){k(e)})})}).catch(function(e){console.log(e)})}function h(e,t){return new google.maps.Marker({position:e.latlng,title:e.name+" "+e.neighborhood,url:v(e),map:t,animation:google.maps.Animation.DROP})}function v(e){return"/restaurant.html?id="+e.id}function c(e,t){return"/img/"+e.photograph+"-"+t+"w.jpg"}function i(e){var t=E.cE("script");t.src=e,t.setAttribute("async",""),E.head.appendChild(t)}function M(e){var t=setTimeout(e);m.addEventListener("resize",function(){clearTimeout(t),t=setTimeout(e,60)})}function B(){var e=u.clientWidth,t=u.clientHeight,n=640<e||640<t?2:1,r=t<e?+(e/t).toFixed(6):+(t/e).toFixed(6);return t<e?(e=640<e?640:e,t=Math.round(e/r)):(t=640<t?640:t,e=Math.round(t/r)),{width:e,height:t,scale:n}}function x(e){fetch(e).then(function(e){return e.blob()}).then(function(e){u.style.backgroundImage="url("+URL.createObjectURL(e)+")",u.style.opacity=1}).catch(function(e){console.log(e)})}function T(){u.style.cursor="pointer",o(u,function(){g()},!0)}function o(t,n,r){var i=function(e){e.preventDefault(),e.stopPropagation(),n(),r&&(t.removeEventListener("click",i),t.removeEventListener("keydown",o))},o=function(e){13===e.keyCode&&i(e,!0)};t.addEventListener("click",i),t.addEventListener("keydown",o)}function g(){y.onLine?(i("https://maps.googleapis.com/maps/api/js?key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA&libraries=places&callback=initMap"),E.gEBI("map").style.display="block",u.removeAttribute("tabindex"),u.removeAttribute("role"),u.removeAttribute("aria-label")):C("x")}function C(e){var t=E.cE("div"),n=E.cE("p");if(t.id="offline-alert",t.setAttribute("role","alert"),n.innerHTML="⚠ You are offline, map is not available.",t.appendChild(n),e){var r=E.cE("p"),i=E.cE("button");i.type="button",i.innerHTML="CLOSE",r.appendChild(i),t.appendChild(r),o(i,function(){t.remove(),u.removeAttribute("class"),T()})}u.className="offline",u.style.opacity=1,u.appendChild(t),u.style.cursor="default"}function S(e){e.addListener("click",function(){m.location.href=e.url})}function A(o,a){var e=new google.maps.OverlayView;if(e.draw=function(){this.getPanes().markerLayer.id="markerLayer"},e.setMap(l),s)o();else var c=l.addListener("tilesloaded",function(){var e,t,n,r,i;o(),e=a,t=E.cE("a"),n=E.cE("h2"),r=E.querySelector('#map div[tabindex="0"]'),i=E.gEBI("map"),t.className="skip-link button",t.href=e?"#filter-options":"#restaurant-container",t.innerHTML="Skip the map",u.insertBefore(t,u.firstChild),n.id="map-label",n.className="sr-only",n.innerHTML="Google Maps Widget: shows restaurants location",u.insertBefore(n,u.firstChild),r.setAttribute("aria-labelledby","map-label"),r.addEventListener("focus",function(){i.classList.add("focused")}),r.addEventListener("blur",function(){i.classList.remove("focused")}),i.addEventListener("focus",function(){l.setOptions({keyboardShortcuts:!0})},!0),i.addEventListener("blur",function(){l.setOptions({keyboardShortcuts:!1})},!0),s=!0,d||E.querySelector('#map div[tabindex="0"]').focus(),google.maps.event.removeListener(c)})}function _(i,o,a){setTimeout(function(){for(var e=E.querySelectorAll('[id^="gmimap"]> area'),n=E.querySelectorAll("#markerLayer img"),t=function(t){e[t].tabIndex=0,e[t].addEventListener("focus",function(){n[t].classList.add("focused")}),e[t].addEventListener("blur",function(){n[t].classList.remove("focused")}),e[t].addEventListener("keydown",function(e){13===e.keyCode&&(i=i||o[t],m.location.href=v(i))})},r=0;r<e.length;r++)t(r);a()},150)}function H(e,t,n){var r=E.cE("img");if(r.className="restaurant-img",r.alt=e.photoDescription||(n?"The "+e.cuisine_type+" Restaurant "+e.name:"The Restaurant "+e.name+" in "+e.neighborhood),r.src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="8" height="6"></svg>',e.photograph){var i=E.cE("picture"),o=E.cE("source"),a=E.cE("source");o.dataset.srcset=function(e){for(var t=[],n=3;n<9;n++)t.push(c(e,100*n)+" "+100*n+"w");return t.join(", ")}(e),a.dataset.srcset=o.dataset.srcset.replace(/w.jpg/g,"w.webp"),o.sizes="(min-width: 1366px) calc((1366px - "+(n?"5rem) / 4":"4rem) / 3")+"), (min-width: 1080px) calc((100vw - 4rem) / 3), (min-width: 700px) calc((100vw - 3rem) / 2), calc(100vw - 2rem)",a.sizes=o.sizes,r.dataset.src=c(e,800),r.classList.add("lazy"),r.onerror=function(){a.remove()},i.append(a,o,r),t.insertBefore(i,t.firstChild)}else r.src="/img/image-fallback.svg",t.insertBefore(r,t.firstChild)}function O(){var e=[].slice.call(E.querySelectorAll(".lazy"));if(e){var i=new IntersectionObserver(function(e){e.forEach(function(e){if(e.isIntersecting){var t=e.target,n=t.parentElement.children[0],r=t.parentElement.children[1];n.srcset=n.dataset.srcset,r.srcset=r.dataset.srcset,t.src=t.dataset.src,t.style.opacity=1,n.removeAttribute("data-srcset"),r.removeAttribute("data-srcset"),t.removeAttribute("data-src"),i.unobserve(t)}})});e.forEach(function(e){i.observe(e)})}}w("restaurants",t).then(function(s){"/"===m.location.pathname||"/index.html"===m.location.pathname?function(){var r=[],i=void 0,o=void 0,p=void 0;function e(){return new Promise(function(e){var t=i[i.selectedIndex].value,n=o[o.selectedIndex].value,r=s.slice(0);"all"!=n&&(r=r.filter(function(e){return e.cuisine_type===n})),"all"!=t&&(r=r.filter(function(e){return e.neighborhood===t})),e(r)})}function a(t){t.forEach(function(e){var t=h(e,l);S(t),r.push(t)}),A(function(){_(null,t,function(){var e=1<t.length?"s":"";E.querySelector("#map iframe").title="Map shows "+t.length+" restaurant"+e})},!0)}function t(){e().then(function(e){var t,n;l&&(t=e,r.length&&(r.forEach(function(e){return e.setMap(null)}),r=[]),a(t)),n=e,p.innerHTML="",c(n),O()}),u&&!l&&(d=!0,g())}function c(e){var t=E.gEBI("results-notice");if(e.length){e.forEach(function(e){var t,n,r,i,o,a,c,s,u,l,d,f;p.appendChild((t=e,n=E.cE("li"),r=E.cE("article"),i=E.cE("h3"),o=E.cE("p"),a=E.cE("strong"),c=E.cE("address"),s=E.cE("p"),u=E.cE("p"),l=E.cE("label"),d=E.cE("input"),f=E.cE("a"),H(t,r,!0),i.innerHTML=t.name,a.innerHTML=""+t.neighborhood,o.appendChild(a),s.innerHTML=t.address,c.appendChild(s),d.type="checkbox",d.id="favorite-"+t.id,d.checked="false"!==t.is_favorite&&("true"===t.is_favorite||t.is_favorite),d.className="button",d.addEventListener("click",function(){L({id:t.id,is_favorite:d.checked})}),l.htmlFor=d.id,l.className="sr-only",l.innerHTML="Is "+t.name+" your favorite restaurant?",f.innerHTML="View Details",f.href=v(t),f.className="button",f.setAttribute("aria-label","View Details about "+t.name),u.append(l,d,f),r.append(i,o,c,u),n.appendChild(r),n))});var n=1<e.length?"s":"";t.innerHTML=e.length+" restaurant"+n+" found"}else t.innerHTML="No restaurants found"}f(function(){u=E.gEBI("static-map"),i=E.gEBI("neighborhoods-select"),o=E.gEBI("cuisines-select"),p=E.gEBI("restaurants-list"),y.onLine?(M(function(){var e;x("https://maps.googleapis.com/maps/api/staticmap?center=40.722216,-73.987501&zoom=12&size="+(e=B()).width+"x"+e.height+"&scale="+e.scale+"&format=jpg&key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA")}),T()):C(),function(){i.addEventListener("change",t),o.addEventListener("change",t);var n=s.map(function(e,t){return s[t].neighborhood});(n=n.filter(function(e,t){return n.indexOf(e)===t})).forEach(function(e){var t=E.cE("option");t.innerHTML=e,t.value=e,i.appendChild(t)});var r=s.map(function(e,t){return s[t].cuisine_type});(r=r.filter(function(e,t){return r.indexOf(e)===t})).forEach(function(e){var t=E.cE("option");t.innerHTML=e,t.value=e,o.appendChild(t)})}(),c(s),O()}),m.initMap=function(){l=new google.maps.Map(E.gEBI("map"),{center:{lat:40.722216,lng:-73.987501},zoom:12,scrollwheel:!1,keyboardShortcuts:!1}),e().then(function(e){a(e)})}}():function(){var o=function(){var e=new URL(m.location.href).searchParams.get("id");if(e&&s[e-1])return s[e-1]}();if(!o)throw new ClientError(404,"File Not Found");function g(e){var t=E.cE("li"),n=E.cE("article"),r=E.cE("header"),i=E.cE("h3"),o=E.cE("span"),a=E.cE("p"),c=E.cE("abbr"),s=E.cE("p");if(o.innerHTML=e.name,e.updatedAt){var u=E.cE("time"),l=new Date(e.updatedAt);u.dateTime=l.toISOString(),u.innerHTML=l.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),u.className="time",i.append(o,u)}else{var d=E.cE("span");d.innerHTML="Review is sending…",d.className="time",i.append(o,d)}return r.appendChild(i),c.title="Rating: "+e.rating+" of 5",c.className="stars-"+e.rating,a.appendChild(c),s.innerHTML=e.comments,n.append(r,a,s),t.appendChild(n),t}f(function(){var e,t,n,r,i;u=E.gEBI("static-map"),y.onLine?(M(function(){var e;x("https://maps.googleapis.com/maps/api/staticmap?size="+(e=B()).width+"x"+e.height+"&scale="+e.scale+"&markers=color:red%7C"+o.latlng.lat+","+o.latlng.lng+"&format=jpg&key=AIzaSyAxfOOcB40yMKfupF4qyfa4hwvhTclZboA")}),T()):C(),e=o,t=E.gEBI("breadcrumb"),n=E.cE("li"),r=E.cE("a"),i=v(e),r.href=i,r.setAttribute("aria-current","page"),r.innerHTML=e.name,n.appendChild(r),t.appendChild(n),function(a){var e=E.querySelector("#restaurant-container> div"),t=E.gEBI("restaurant-name"),n=E.gEBI("restaurant-address"),r=E.gEBI("restaurant-cuisine"),i=E.cE("strong"),o=E.gEBI("favorite"),c=E.gEBI("add-review-button"),s=E.gEBI("overlay"),u=E.querySelector("#overlay form"),l=E.gEBI("username"),d=[].slice.call(E.getElementsByName("rating")),f=E.gEBI("comments"),p=E.gEBI("close-overlay-button"),h=E.gEBI("page"),v=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]"].join(",");E.title=a.name+" - Restaurant Info and Reviews",H(a,e),t.innerHTML=a.name,n.innerHTML=a.address,i.innerHTML="Type of Cuisine: "+a.cuisine_type,r.appendChild(i),a.operating_hours&&function(e){var t=E.gEBI("restaurant-hours");for(var n in e){var r=E.cE("tr"),i=E.cE("th"),o=E.cE("td");i.innerHTML=n,i.scope="row",o.innerHTML=e[n],r.append(i,o),t.appendChild(r)}}(a.operating_hours);o.checked="false"!==a.is_favorite&&("true"===a.is_favorite||a.is_favorite),o.addEventListener("click",function(){L({id:a.id,is_favorite:o.checked})}),c.addEventListener("click",function(){var e=[].slice.call(h.querySelectorAll(v)),t=[].slice.call(h.querySelectorAll('[tabindex="0"]')),n=[].slice.call(s.querySelectorAll('[tabindex="-1"]'));function r(e){27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),o(),p.removeEventListener("click",o))}function i(e){e.preventDefault(),e.stopPropagation();var t={restaurant_id:a.id,name:l.value,rating:parseInt(d.filter(function(e){return!0===e.checked})[0].value),comments:f.value};!function(n){!y.onLine&&y.serviceWorker&&m.SyncManager&&m.indexedDB&&k(n,!0).then(function(t){y.serviceWorker.ready.then(function(e){return e.sync.register("review-sync-"+t)}).catch(function(e){console.log(e),I(n)})});I(n)}(t);var n=E.gEBI("reviews-list");n.insertBefore(g(t),n.firstChild),u.reset(),o()}function o(){e.forEach(function(e){e.removeAttribute("tabindex")}),t.forEach(function(e){e.tabIndex=0}),n.forEach(function(e){e.tabIndex=-1}),h.removeAttribute("aria-hidden"),s.classList.remove("opened"),s.setAttribute("aria-hidden",!0),c.focus(),E.removeEventListener("keydown",r),u.removeEventListener("onsubmit",i)}e.forEach(function(e){e.tabIndex=-1}),t.forEach(function(e){e.tabIndex=-1}),n.forEach(function(e){e.tabIndex=0}),s.removeAttribute("aria-hidden"),s.classList.add("opened"),h.setAttribute("aria-hidden",!0),l.focus(),p.addEventListener("click",o),E.addEventListener("keydown",r),u.addEventListener("submit",i)}),w("reviews",b+a.id,a.id).then(function(e){!function(e){var t=E.gEBI("reviews-container"),n=E.cE("h2"),r=E.gEBI("reviews-list");if(n.innerHTML="Reviews",t.insertBefore(n,t.firstChild),!e){var i=E.cE("p");return i.innerHTML=y.online?"No reviews yet!":"Sorry, reviews for this restaurant are not available offline.",t.insertBefore(i,t.lastChild)}e.reverse().forEach(function(e){r.appendChild(g(e))})}(e)}).catch(function(e){console.log(e)})}(o),O()}),m.initMap=function(){l=new google.maps.Map(E.gEBI("map"),{center:o.latlng,zoom:17,scrollwheel:!1,keyboardShortcuts:!1}),S(h(o,l)),A(function(){_(o,null,function(){E.querySelector("#map iframe").title="Map shows "+o.name+" location"})})}}()}).catch(function(e){console.log(e)})}(window,document,navigator);
//# sourceMappingURL=app.js.map
